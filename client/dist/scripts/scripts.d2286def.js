!function(){"use strict";function a(a,b,c,d){var e="http://picterest-backend.herokuapp.com";c.theme("default").primaryPalette("grey").accentPalette("cyan").warnPalette("red").dark(),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"vm"}).when("/user/:username",{templateUrl:"views/main.html",controller:"UserBoardCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),d.html5Mode(!0),b.github({clientId:"8eeaab0ee8e8495d69f6",redirectUri:"http://ubershibs-picterest.herokuapp.com",url:e+"/auth/github"}),b.twitter({url:e+"/auth/twitter",redirectUri:"http://ubershibs-picterest.herokuapp.com"})}function b(a,b,c){if(c.isAuthenticated()){var d=c.getPayload();a.currentUser=d.sub}}angular.module("picterestApp",["ngAnimate","ngRoute","ngSanitize","ngMaterial","satellizer"]).config(a).run(b),a.$inject=["$routeProvider","$authProvider","$mdThemingProvider","$locationProvider"],b.$inject=["$rootScope","$window","$auth"]}(),function(){"use strict";function a(a,b,c,d){function e(){return d(function(b,c){a({method:"GET",url:u+"/api/pics"}).then(function(a){var c=p(a.data);c=r(c),v=s(c),b(v)},function(a){c(a)})})}function f(b){return d(function(c,d){a({method:"GET",url:u+"/api/pics/"+b}).then(function(a){var b=p(a.data);b=r(b),v=s(b),c(v)},function(a){d(a)})})}function g(b,c,d){var e="",f={image:b,title:c,ratio:d};a({method:"POST",url:u+"/api/pics",data:f}).then(function(a){if("dupe"===a.data.type)w=a.data.message;else if("repost"===a.data.type){w=a.data.message,e=q(a.data.pic);var b=o(v,e._id);v[b]=e}else"new"===a.data.type&&(w=a.data.message,e=q(a.data.pic),v.push(e))})}function h(b,c){var d={pic:b,user:c};return a({method:"POST",url:u+"/api/pic/"+b._id,data:d}).then(function(a){var b="";if("dupe"===a.data.type)w=a.data.message;else if("repost"===a.data.type){w=a.data.message,b=q(a.data.pic);var d=o(v,b._id);b.reposter=!0,b.likers.indexOf(c)>-1?b.liked=!0:b.liked=!1,v[d]=b}})}function i(){return v}function j(){return w}function k(){w=null}function l(b,c){a({method:"DELETE",url:u+"/api/pic/"+b._id}).then(function(a){w=a.data.message;var c=o(v,b._id);v.splice(c,1)})}function m(e,f){return d(function(d,g){var h,i={pic:e,user:f};a.post(u+"/api/pic/"+e._id+"/like",i).then(function(a){if(w=a.data.message,h=q(a.data.pic),h.liked=!0,c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);h=t(h,e)}else h.reposter=!1;var f=o(v,h._id);v[f]=h,d(h)},function(a){g(a)})})}function n(e,f){return d(function(d,f){var g;a.delete(u+"/api/pic/"+e._id+"/like").then(function(a){if(w=a.data.message,g=q(a.data.pic),g.liked=!1,c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);g=t(g,e)}else g.reposter=!1;var f=o(v,g._id);v[f]=g,d(g)},function(a){f(a)})})}function o(a,b){for(var c=0;c<a.length;c++)if(a[c]._id===b)return c;throw"Could not find object with id: "+b}function p(a){var b=[];return a.forEach(function(a){a=q(a),b.push(a)}),b}function q(a){var b=2;return a.ratio<.8?(a.colSpan=b,a.rowSpan=Math.floor(b/a.ratio)):a.ratio>1.2?(a.rowSpan=b,a.colSpan=Math.floor(b*a.ratio)):(a.rowSpan=b,a.colSpan=b),a}function r(a){var d=[];if(c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);a.forEach(function(a){a.likers.indexOf(e._id)>-1?a.liked=!0:a.liked=!1,d.push(a)})}else a.forEach(function(a){a.liked=!1,d.push(a)});return d}function s(a){var d=[];if(c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);a.forEach(function(a){a=t(a,e),d.push(a)})}else a.forEach(function(a){a.reposter=!1,d.push(a)});return d}function t(a,b){var c=[];return a.posters.forEach(function(a){c.push(a._id)}),c.indexOf(b._id)>0?a.reposter=!0:a.reposter=!1,a}var u="http://picterest-backend.herokuapp.com",v=[],w=null,x={getAllThePics:e,getUserPics:f,savePic:g,repostPic:h,getCurrentPics:i,getStatusMessage:j,clearStatusMessage:k,deleteThis:l,like:m,unlike:n};return x}angular.module("picterestApp").factory("DataService",a),a.$inject=["$http","$window","$auth","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(c){b.show(b.simple().textContent(c).hideDelay(5e3)),a.clearStatusMessage()}function h(){return c.isAuthenticated()}function i(){a.getAllThePics().then(function(a){n.pics=a},function(a){console.log(a)})}function j(b,c){n.isAuthenticated()===!0?a.like(b,n.user).then(function(a){return a}):m(c,"like")}function k(b,c){n.isAuthenticated()===!0?a.unlike(b,n.user).then(function(a){return a}):m(c,"unlike")}function l(b,c){n.isAuthenticated()===!0?a.repostPic(b,n.user).then(function(a){return a}):m(c,"repost pics")}function m(a,b){var c="Only signed-in users can "+b+".";c+="Use the buttons at the top right of the screen to sign in.",f.show(f.alert(a,c).parent(angular.element(document.querySelector("md-content"))).clickOutsideToClose(!0).title("Please Sign In to Continue").textContent(c).ariaLabel("Sign In Dialog").ok("Got it!").targetEvent(a))}var n=this;n.pics=[],n.user="",n.getAllThePics=i,n.likeThis=j,n.isAuthenticated=h,n.showToast=g,n.isOwnPage=!1,n.unlikeThis=k,n.repostThis=l,function(){n.pics=[],n.getAllThePics(),h()&&(n.user=JSON.parse(d.localStorage.currentUser))}(),e.$watch(function(){return a.getCurrentPics()},function(a,b){null!=a&&(n.pics=a)}),e.$watch(function(){return a.getStatusMessage()},function(a,b){null!=a&&n.showToast(a)})}angular.module("picterestApp").controller("MainCtrl",a),a.$inject=["DataService","$mdToast","$auth","$window","$scope","$mdDialog"]}(),function(){"use strict";function a(a,c,d,e,f){function g(b){a.authenticate(b).then(function(b){c.localStorage.currentUser=JSON.stringify(b.data.user),d.currentUser=JSON.parse(c.localStorage.currentUser),k.user=d.currentUser,k.isAuthenticated=a.isAuthenticated()})}function h(){a.logout(),c.localStorage.removeItem("currentUser"),d.currentUser=null,k.isAuthenticated=a.isAuthenticated()}function i(){var a=new RegExp("^/user/.+$"),b=f.path();if("/"===b)return"Everyone";if(a.test(b)){var c=b.split("/"),d=c[2].substr(2);return d}}function j(){var a=k._mdPanel.newPanelPosition().absolute().center(),c={attachTo:angular.element(document.body),controller:b,controllerAs:"ctrl",disableParentScroll:k.disableParentScroll,templateUrl:"views/add.panel.html",hasBackdrop:!0,panelClass:"addPicDialog",position:a,trapFocus:!0,zIndex:150,clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0};k._mdPanel.open(c)}var k=this;k.authenticate=g,k.user=null,k.isAuthenticated=a.isAuthenticated(),k.logout=h,k.addPicModal=j,k._mdPanel=e,k.disableParentScroll=!1,k.title=i,function(){k.isAuthenticated&&(k.user=JSON.parse(c.localStorage.currentUser))}()}function b(a,b,c){function d(a,c){f(a).then(function(d){b.savePic(a,c,d),g.closeDialog()})}function e(){g._mdPanelRef.close()}function f(a){return c(function(b,c){var d=new Image;d.src=a,d.onload=function(){var a=d.naturalHeight,c=d.naturalWidth,e=c/a;b(e)}})}var g=this;g.imgSrc="",g._mdPanelRef=a,g.closeDialog=e,g.savePic=d}angular.module("picterestApp").controller("NavigationCtrl",a),a.$inject=["$auth","$window","$rootScope","$mdPanel","$location"],b.$inject=["mdPanelRef","DataService","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(c){b.show(b.simple().textContent(c).hideDelay(5e3)),a.clearStatusMessage()}function i(){return c.isAuthenticated()}function j(b){a.getUserPics(b).then(function(a){p.pics=a},function(a){console.log(a)})}function k(b,c){p.isAuthenticated()===!0?a.like(b,p.user).then(function(a){return a}):o(c,"like")}function l(b){a.deleteThis(b,p.user)}function m(b,c){p.isAuthenticated()===!0?a.unlike(b,p.user).then(function(a){return a}):o(c,"unlike")}function n(b,c){p.isAuthenticated()===!0?a.repostPic(b,p.user).then(function(a){return a}):o(c,"repost pics")}function o(a,b){var c="Only signed-in users can "+b+".";c+="Use the buttons at the top right of the screen to sign in.",g.show(g.alert(a,c).parent(angular.element(document.querySelector("md-content"))).clickOutsideToClose(!0).title("Please Sign In to Continue").textContent(c).ariaLabel("Sign In Dialog").ok("Got it!").targetEvent(a))}var p=this;p.pics=[],p.user=null,p.poster=f.username.substr(2),p.getUserPics=j,p.likeThis=k,p.isAuthenticated=i,p.showToast=h,p.isOwnPage=!1,p.deleteThis=l,p.unlikeThis=m,p.repostThis=n,function(){p.pics=[],p.getUserPics(p.poster),i&&(p.user=JSON.parse(d.localStorage.currentUser)),p.user.username===p.poster&&(p.isOwnPage=!0)}(),e.$watch(function(){return a.getCurrentPics()},function(a,b){null!=a&&(p.pics=a)}),e.$watch(function(){return a.getStatusMessage()},function(a,b){null!=a&&p.showToast(a)})}angular.module("picterestApp").controller("UserBoardCtrl",a),a.$inject=["DataService","$mdToast","$auth","$window","$scope","$routeParams","$mdDialog"]}(),function(){function a(){return{link:function(a,b,c){b.bind("error",function(){c.src!==c.errSrc&&c.$set("src",c.errSrc)}),c.$observe("ngSrc",function(a){!a&&c.errSrc&&c.$set("src",c.errSrc)})}}}angular.module("picterestApp").directive("errSrc",a)}(),angular.module("picterestApp").run(["$templateCache",function(a){"use strict";a.put("views/add.panel.html",'<div role="dialog" aria-label="Add a picture" layout="column" layout-align="center center"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Add a picture</h2> </div> </md-toolbar> <div class="add-dialog-content"> <div layout="row"> <div ng-show="ctrl.imgSrc" class="preview"><img ng-src="{{ ctrl.imgSrc }}" class="preview" err-src="images/images.png"></div> <div ng-hide="ctrl.imgSrc" id="addPicImage" flex> <span>Image Preview</span> </div> </div> </div> <div layout="column" class="add-dialog-content"> <form name="addPic"> <md-input-container class="md-block"> <label for="imgSrc">Image URL</label> <input id="imgSrc" ng-model="ctrl.imgSrc" name="imgSrc" required> <div ng-messages="addPic.imgSrc.$error"> <div ng-message="required">A title is required.</div> </div> </md-input-container> <md-input-container class="md-block"> <label for="imgTitle">Title</label> <input id="imgTitle" ng-model="imgTitle" name="imgTitle" required> <div ng-messages="addPic.imgTitle.$error"> <div ng-message="required">A title is required.</div> </div> </md-input-container> <div layout="row"> <md-button flex class="md-accent add-dialog-button" ng-click="ctrl.savePic(ctrl.imgSrc, imgTitle)"> Save </md-button> <md-button class="md-warn" flex="25" ng-click="ctrl.closeDialog()"> Cancel </md-button> </div> </form> </div> </div>'),a.put("views/main.html",'<div layout="column" flex="grow" layout-padding> <div ng-hide="vm.pics.length === 0" layout="column" layout-fill> <md-grid-list md-cols-xs="2" md-cols-sm="6" md-cols-md="8" md-cols-lg="10" md-cols-xl="12" md-gutter="1em" md-row-height="13:16" flex> <md-grid-tile ng-repeat="pic in vm.pics" md-colspan-xs="2" md-colspan="{{ pic.colSpan }}" md-rowspan="{{ pic.rowSpan }}" layout-padding> <md-card md-whiteframe="10" ng-hide="vm.pics.length === 0" layout-padding class="grid-item"> <md-card-title-text> <div class="md-headline">{{ pic.title }}</div> <div layout="row" layout-align="start center"> <span class="md-subhead"><a ng-href="/user/{{ pic.posters[0].userPrefix }}{{ pic.posters[0].username }}"> <i class="fa fa-github" ng-show="pic.posters[0].githubId.length > 0"></i> <i class="fa fa-twitter" ng-show="pic.posters[0].twitterId.length > 0"></i> {{ pic.posters[0].username }}</a></span> <md-button class="md-icon-button" ng-show="pic.liked === false" ng-click="vm.likeThis(pic, $event)"> <md-icon>favorite</md-icon> <md-tooltip>Like This</md-tooltip> </md-button> <md-button class="md-icon-button" ng-show="pic.liked === true" ng-click="vm.unlikeThis(pic, $event)"> <md-icon class="cyan">favorite</md-icon> <md-tooltip>Unlike This</md-tooltip> </md-button> <span class="md-subhead">{{ pic.likers.length }}</span> <md-button class="md-icon-button" ng-show="pic.reposter === false" ng-click="vm.repostThis(pic, $event)"> <md-icon>replay</md-icon> <md-tooltip>Repost</md-tooltip> </md-button> <md-button class="md-icon-button" ng-show="pic.reposter === true"> <md-icon class="cyan">replay</md-icon> <md-tooltip>Reposted!</md-tooltip> </md-button> <span class="md-subhead">{{ pic.posters.length - 1 }}</span> <md-button class="md-icon-button" ng-show="vm.isOwnPage === true" ng-click="vm.deleteThis(pic)"> <md-icon>delete_forever</md-icon> <md-tooltip>Delete permanently</md-tooltip> </md-button> </div> </md-card-title-text> <div layout="row" layout-align="center center"> <img ng-src="{{ pic.url }}" err-src="images/image.1bdef0b5.png" class="md-card-image" alt="{{ pic.title }}"> </div> </md-card> </md-grid-tile> </md-grid-list> </div> </div> <!--\n -->')}]);