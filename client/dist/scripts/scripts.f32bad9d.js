!function(){"use strict";function a(a,b,c,d){var e="http://picterest-backend.herokuapp.com";c.theme("default").primaryPalette("grey").accentPalette("cyan").warnPalette("red").dark(),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"vm"}).when("/user/:username",{templateUrl:"views/main.html",controller:"UserBoardCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),d.html5Mode(!0),b.github({clientId:"8eeaab0ee8e8495d69f6",redirectUri:"http://ubershibs-picterest.herokuapp.com",url:e+"/auth/github"}),b.twitter({url:e+"/auth/twitter",redirectUri:"http://ubershibs-picterest.herokuapp.com"})}function b(a,b,c){if(c.isAuthenticated()){var d=c.getPayload();a.currentUser=d.sub}}angular.module("picterestApp",["ngAnimate","ngRoute","ngSanitize","ngMaterial","satellizer","mdLightbox"]).config(a).run(b),a.$inject=["$routeProvider","$authProvider","$mdThemingProvider","$locationProvider"],b.$inject=["$rootScope","$window","$auth"]}(),function(){"use strict";function a(a,b,c,d){function e(){return d(function(b,c){a({method:"GET",url:v+"/api/pics"}).then(function(a){var c=q(a.data);c=s(c),w=t(c),b(w)},function(a){c(a)})})}function f(b){return d(function(c,d){var e=b.substr(0,2),f=b.substr(2);a({method:"GET",url:v+"/api/pics/"+e+"/"+f}).then(function(a){var b=q(a.data);b=s(b),w=t(b),c(w)},function(a){d(a)})})}function g(c,d,e){var f="",g={image:c,title:d,ratio:e};a({method:"POST",url:v+"/api/pics",data:g}).then(function(a){if(y=JSON.parse(b.localStorage.currentUser),"dupe"===a.data.type)x=a.data.message;else if("repost"===a.data.type){x=a.data.message,f=r(a.data.pic),f.likers.indexOf(y._id)!==-1?f.isLiked=!0:f.isLiked=!1;var c=p(w,f._id);w[c]=f}else"new"===a.data.type&&(x=a.data.message,f=r(a.data.pic),f.isLiked=!1,f.isReposter=!1,w.push(f))})}function h(b,c){var d={pic:b,user:c};return a({method:"POST",url:v+"/api/pic/"+b._id,data:d}).then(function(a){var b="";if("dupe"===a.data.type)x=a.data.message;else if("repost"===a.data.type){x=a.data.message,b=r(a.data.pic);var d=p(w,b._id);b.reposter=!0,b.likers.indexOf(c._id)>-1?b.liked=!0:b.liked=!1,w[d]=b}})}function i(){return w}function j(){return x}function k(){x=null}function l(b,c){a({method:"DELETE",url:v+"/api/pic/"+b._id}).then(function(a){x=a.data.message;var c=p(w,b._id);w.splice(c,1)})}function m(e,f){return d(function(d,g){var h,i={pic:e,user:f};a.post(v+"/api/pic/"+e._id+"/like",i).then(function(a){if(x=a.data.message,h=r(a.data.pic),h.liked=!0,c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);h=u(h,e)}else h.reposter=!1;var f=p(w,h._id);w[f]=h,d(h)},function(a){g(a)})})}function n(e,f){return d(function(d,f){var g;a.delete(v+"/api/pic/"+e._id+"/like").then(function(a){if(x=a.data.message,g=r(a.data.pic),g.liked=!1,c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);g=u(g,e)}else g.reposter=!1;var f=p(w,g._id);w[f]=g,d(g)},function(a){f(a)})})}function o(b){return d(function(c,d){var e=b.substr(0,2),f=b.substr(2);a.get(v+"/api/user/"+e+"/"+f).then(function(a){var b=a.data.user;c(b)},function(a){d(a)})})}function p(a,b){for(var c=0;c<a.length;c++)if(a[c]._id===b)return c;throw"Could not find object with id: "+b}function q(a){var b=[];return a.forEach(function(a){a=r(a),b.push(a)}),b}function r(a){var b=2;return a.ratio<.8?(a.colSpan=b,a.rowSpan=Math.floor(b/a.ratio)):a.ratio>1.2?(a.rowSpan=b,a.colSpan=Math.floor(b*a.ratio)):(a.rowSpan=b,a.colSpan=b),a}function s(a){var d=[];if(c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);a.forEach(function(a){a.likers.indexOf(e._id)>-1?a.liked=!0:a.liked=!1,d.push(a)})}else a.forEach(function(a){a.liked=!1,d.push(a)});return d}function t(a){var d=[];if(c.isAuthenticated()===!0){var e=JSON.parse(b.localStorage.currentUser);a.forEach(function(a){a=u(a,e),d.push(a)})}else a.forEach(function(a){a.reposter=!1,d.push(a)});return d}function u(a,b){var c=[];return a.posters.forEach(function(a){c.push(a._id)}),c.indexOf(b._id)>0?a.reposter=!0:a.reposter=!1,a}var v="http://picterest-backend.herokuapp.com",w=[],x=null,y=null,z={getAllThePics:e,getUserPics:f,savePic:g,repostPic:h,getCurrentPics:i,getStatusMessage:j,clearStatusMessage:k,deleteThis:l,like:m,unlike:n,getUser:o};return z}angular.module("picterestApp").factory("DataService",a),a.$inject=["$http","$window","$auth","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f){function g(c){b.show(b.simple().textContent(c).hideDelay(5e3)),a.clearStatusMessage()}function h(){return c.isAuthenticated()}function i(){a.getAllThePics().then(function(a){n.pics=a},function(a){console.log(a)})}function j(b,c){n.isAuthenticated()===!0?a.like(b,n.user).then(function(a){return a}):m(c,"like")}function k(b,c){n.isAuthenticated()===!0?a.unlike(b,n.user).then(function(a){return a}):m(c,"unlike")}function l(b,c){n.isAuthenticated()===!0?a.repostPic(b,n.user).then(function(a){return a}):m(c,"repost pics")}function m(a,b){var c="Only signed-in users can "+b+".";c+="Use the buttons at the top right of the screen to sign in.",f.show(f.alert(a,c).parent(angular.element(document.querySelector("md-content"))).clickOutsideToClose(!0).title("Please Sign In to Continue").textContent(c).ariaLabel("Sign In Dialog").ok("Got it!").targetEvent(a))}var n=this;n.pics=[],n.user="",n.getAllThePics=i,n.likeThis=j,n.isAuthenticated=h,n.showToast=g,n.isOwnPage=!1,n.unlikeThis=k,n.repostThis=l,function(){n.pics=[],n.getAllThePics(),h()&&(n.user=JSON.parse(d.localStorage.currentUser)),console.log(n.pics)}(),e.$watch(function(){return a.getCurrentPics()},function(a,b){null!=a&&(n.pics=a)}),e.$watch(function(){return a.getStatusMessage()},function(a,b){null!=a&&n.showToast(a)})}angular.module("picterestApp").controller("MainCtrl",a),a.$inject=["DataService","$mdToast","$auth","$window","$scope","$mdDialog"]}(),function(){"use strict";function a(a,c,d,e,f){function g(b){a.authenticate(b).then(function(b){c.localStorage.currentUser=JSON.stringify(b.data.user),d.currentUser=JSON.parse(c.localStorage.currentUser),k.user=d.currentUser,k.isAuthenticated=a.isAuthenticated()})}function h(){a.logout(),c.localStorage.removeItem("currentUser"),d.currentUser=null,k.isAuthenticated=a.isAuthenticated()}function i(){var a=new RegExp("^/user/.+$"),b=f.path();if("/"===b)return"Everyone";if(a.test(b)){var c=b.split("/"),d=c[2].substr(2);return d}}function j(){var a=k._mdPanel.newPanelPosition().absolute().center(),c={attachTo:angular.element(document.body),controller:b,controllerAs:"ctrl",disableParentScroll:k.disableParentScroll,templateUrl:"views/add.panel.html",hasBackdrop:!0,panelClass:"addPicDialog",position:a,trapFocus:!0,zIndex:150,clickOutsideToClose:!1,escapeToClose:!0,focusOnOpen:!0};k._mdPanel.open(c)}var k=this;k.authenticate=g,k.user=null,k.isAuthenticated=a.isAuthenticated(),k.logout=h,k.addPicModal=j,k._mdPanel=e,k.disableParentScroll=!1,k.title=i,function(){k.isAuthenticated&&(k.user=JSON.parse(c.localStorage.currentUser))}()}function b(a,b,c){function d(a,c){f(a).then(function(d){b.savePic(a,c,d),g.closeDialog()})}function e(){g._mdPanelRef.close()}function f(a){return c(function(b,c){var d=new Image;d.src=a,d.onload=function(){var a=d.naturalHeight,c=d.naturalWidth,e=c/a;b(e)}})}var g=this;g.imgSrc="",g._mdPanelRef=a,g.closeDialog=e,g.savePic=d}angular.module("picterestApp").controller("NavigationCtrl",a),a.$inject=["$auth","$window","$rootScope","$mdPanel","$location"],b.$inject=["mdPanelRef","DataService","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(c){b.show(b.simple().textContent(c).hideDelay(5e3)),a.clearStatusMessage()}function i(){return c.isAuthenticated()}function j(b){a.getUserPics(b).then(function(a){p.pics=a},function(a){console.log(a)})}function k(b,c){p.isAuthenticated()===!0?a.like(b,p.user).then(function(a){return a}):o(c,"like")}function l(b){a.deleteThis(b,p.user)}function m(b,c){p.isAuthenticated()===!0?a.unlike(b,p.user).then(function(a){return a}):o(c,"unlike")}function n(b,c){p.isAuthenticated()===!0?a.repostPic(b,p.user).then(function(a){return a}):o(c,"repost pics")}function o(a,b){var c="Only signed-in users can "+b+".";c+="Use the buttons at the top right of the screen to sign in.",g.show(g.alert(a,c).parent(angular.element(document.querySelector("md-content"))).clickOutsideToClose(!0).title("Please Sign In to Continue").textContent(c).ariaLabel("Sign In Dialog").ok("Got it!").targetEvent(a))}var p=this;p.pics=[],p.user=null,p.poster=null,p.getUserPics=j,p.likeThis=k,p.isAuthenticated=i,p.showToast=h,p.isOwnPage=null,p.deleteThis=l,p.unlikeThis=m,p.repostThis=n,function(){p.pics=[],p.getUserPics(f.username),p.poster=a.getUser(f.username),i&&(p.user=JSON.parse(d.localStorage.currentUser),f.username===p.user.userPrefix+p.user.username&&(p.isOwnPage=!0))}(),e.$watch(function(){return a.getCurrentPics()},function(a,b){null!=a&&(p.pics=a)}),e.$watch(function(){return a.getStatusMessage()},function(a,b){null!=a&&p.showToast(a)})}angular.module("picterestApp").controller("UserBoardCtrl",a),a.$inject=["DataService","$mdToast","$auth","$window","$scope","$routeParams","$mdDialog"]}(),function(){function a(){return{link:function(a,b,c){b.bind("error",function(){c.src!==c.errSrc&&c.$set("src",c.errSrc)}),c.$observe("ngSrc",function(a){!a&&c.errSrc&&c.$set("src",c.errSrc)})}}}angular.module("picterestApp").directive("errSrc",a)}(),angular.module("mdLightbox",["ngMaterial"]).directive("mdLightbox",["$mdDialog",function(a){return{link:function(b,c,d){function e(b,c){function d(a,d){a.image=b,a.title=c,a.cancel=function(){d.cancel()}}var e=a.confirm({templateUrl:"views/lightbox.html",clickOutsideToClose:!0,controller:d});a.show(e)}c.addClass("image-click"),c.on("click",function(){var a=d.src,b=d.mdLightboxTitle;e(a,b)})}}}]),angular.module("picterestApp").run(["$templateCache",function(a){"use strict";a.put("views/add.panel.html",'<div role="dialog" aria-label="Add a picture" layout="column" layout-align="center center"> <md-toolbar> <div class="md-toolbar-tools"> <h2>Add a picture</h2> </div> </md-toolbar> <div class="add-dialog-pic"> <div layout="row"> <div ng-show="ctrl.imgSrc" class="preview"><img ng-src="{{ ctrl.imgSrc }}" class="preview" err-src="images/images.png"></div> <div ng-hide="ctrl.imgSrc" id="addPicImage" flex> <span>Image Preview</span> </div> </div> </div> <div layout="column" class="add-dialog-content" layout-fill> <form name="addPic" class="addPicForm"> <md-input-container class="md-block"> <label for="imgSrc">Image URL</label> <input id="imgSrc" ng-model="ctrl.imgSrc" name="imgSrc" required> <div ng-messages="addPic.imgSrc.$error"> <div ng-message="required">A URL is required.</div> </div> </md-input-container> <md-input-container class="md-block"> <label for="imgTitle">Title</label> <input id="imgTitle" ng-model="imgTitle" name="imgTitle" required> <div ng-messages="addPic.imgTitle.$error"> <div ng-message="required">A title is required.</div> </div> </md-input-container> <div layout="row" class="add-dialog-button"> <md-button flex-xs="50" flex-gt-xs class="md-accent" ng-click="ctrl.savePic(ctrl.imgSrc, imgTitle)" id="imgSave"> Save </md-button> <md-button class="md-warn" flex-xs="50" flex-gt-xs="25" ng-click="ctrl.closeDialog()"> Cancel </md-button> </div> </form> </div> <script>$(\'#imgSrc\').on("keypress", function(e) {\n    var code = e.keyCode || e.which;\n    if(code == 13) { //Enter keycode\n'+"      $('#imgSave').trigger('click');\n    }\n  });\n  $('#imgTitle').on(\"keypress\", function(e) {\n    var code = e.keyCode || e.which;\n    if(code == 13) { //Enter keycode\n      $('#imgSave').trigger('click');\n    }\n  });</script> </div>"),a.put("views/lightbox.html",'<md-dialog aria-label="Lightbox"> <md-toolbar> <div class="md-toolbar-tools"> <h2 ng-if="title" ng-bind="title"></h2> <span flex></span> <md-button class="md-icon-button" ng-click="cancel()"> <md-icon md-font-library="material-icons" aria-label="Close" class="icon-static">close</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <img ng-src="{{image}}" alt="{{title}}" style="width: 100%; height: 100%"> </md-dialog-content> </md-dialog>'),a.put("views/main.html",'<md-content flex md-scroll-y> <md-grid-list md-cols-xs="2" md-cols-sm="6" md-cols-md="8" md-cols-lg="10" md-cols-xl="12" md-gutter="2em" md-row-height="13:16" ng-hide="vm.pics.length === 0"> <md-grid-tile ng-repeat="pic in vm.pics" md-colspan-xs="2" md-colspan="{{ pic.colSpan }}" md-rowspan="{{ pic.rowSpan }}" layout-padding> <md-card md-whiteframe="10" ng-hide="vm.pics.length === 0" class="grid-item pic-card"> <md-card-title-text class="title-text"> <div class="md-headline">{{ pic.title }}</div> <div layout="row" layout-align="start center"> <span class="md-subhead"><a ng-href="/user/{{ pic.posters[0].userPrefix }}{{ pic.posters[0].username }}"> <i class="fa fa-github" ng-show="pic.posters[0].githubId.length > 0"></i> <i class="fa fa-twitter" ng-show="pic.posters[0].twitterId.length > 0"></i> {{ pic.posters[0].username }}</a></span> <md-button class="md-icon-button no-margin" ng-show="pic.liked === false" ng-click="vm.likeThis(pic, $event)"> <md-icon>favorite</md-icon> <md-tooltip>Like This</md-tooltip> </md-button> <md-button class="md-icon-button no-margin" ng-show="pic.liked === true" ng-click="vm.unlikeThis(pic, $event)"> <md-icon class="cyan">favorite</md-icon> <md-tooltip>Unlike This</md-tooltip> </md-button> <span class="subhead">{{ pic.likers.length }}</span> <md-button class="md-icon-button no-margin" ng-show="pic.reposter === false" ng-click="vm.repostThis(pic, $event)"> <md-icon>replay</md-icon> <md-tooltip>Repost</md-tooltip> </md-button> <md-button class="md-icon-button no-margin" ng-show="pic.reposter === true"> <md-icon class="cyan">replay</md-icon> <md-tooltip>Reposted!</md-tooltip> </md-button> <span class="subhead">{{ pic.posters.length - 1 }}</span> <md-button class="md-icon-button" ng-show="vm.isOwnPage === true" ng-click="vm.deleteThis(pic)"> <md-icon>delete_forever</md-icon> <md-tooltip>Delete permanently</md-tooltip> </md-button> </div> </md-card-title-text> <div layout="row" layout-align="center center"> <img ng-src="{{ pic.url }}" err-src="images/image.1bdef0b5.png" md-lightbox class="md-card-image" alt="{{ pic.title }}"> </div> </md-card> </md-grid-tile> </md-grid-list> </md-content> <!--\n -->'),a.put("views/old_main.html",'<div layout="column" flex="grow" layout-padding> <div ng-hide="vm.pics.length === 0" layout="column" layout-fill> <md-grid-list md-cols-xs="2" md-cols-sm="6" md-cols-md="8" md-cols-lg="10" md-cols-xl="12" md-gutter="2em" md-row-height="13:16" flex> <md-grid-tile ng-repeat="pic in vm.pics" md-colspan-xs="2" md-colspan="{{ pic.colSpan }}" md-rowspan="{{ pic.rowSpan }}" layout-padding> <md-card md-whiteframe="10" ng-hide="vm.pics.length === 0" layout-padding class="grid-item pic-card"> <md-card-title-text> <div class="md-headline">{{ pic.title }}</div> <div layout="row" layout-align="start center"> <span class="subhead"><a ng-href="/user/{{ pic.posters[0].userPrefix }}{{ pic.posters[0].username }}"> <i class="fa fa-github" ng-show="pic.posters[0].githubId.length > 0"></i> <i class="fa fa-twitter" ng-show="pic.posters[0].twitterId.length > 0"></i> {{ pic.posters[0].username }}</a></span> <md-button class="md-icon-button" ng-show="pic.liked === false" ng-click="vm.likeThis(pic, $event)"> <md-icon>favorite</md-icon> <md-tooltip>Like This</md-tooltip> </md-button> <md-button class="md-icon-button" ng-show="pic.liked === true" ng-click="vm.unlikeThis(pic, $event)"> <md-icon class="cyan">favorite</md-icon> <md-tooltip>Unlike This</md-tooltip> </md-button> <span class="subhead">{{ pic.likers.length }}</span> <md-button class="md-icon-button" ng-show="pic.reposter === false" ng-click="vm.repostThis(pic, $event)"> <md-icon>replay</md-icon> <md-tooltip>Repost</md-tooltip> </md-button> <md-button class="md-icon-button" ng-show="pic.reposter === true"> <md-icon class="cyan">replay</md-icon> <md-tooltip>Reposted!</md-tooltip> </md-button> <span class="subhead">{{ pic.posters.length - 1 }}</span> <md-button class="md-icon-button" ng-show="vm.isOwnPage === true" ng-click="vm.deleteThis(pic)"> <md-icon>delete_forever</md-icon> <md-tooltip>Delete permanently</md-tooltip> </md-button> </div> </md-card-title-text> <div layout="row" layout-align="center center"> <img ng-src="{{ pic.url }}" err-src="images/image.1bdef0b5.png" md-lightbox class="md-card-image" alt="{{ pic.title }}"> </div> </md-card> </md-grid-tile> </md-grid-list> </div> </div> <!--\n -->')}]);